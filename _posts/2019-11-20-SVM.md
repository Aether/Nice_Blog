---
layout: post
title: "ğŸ£ SVMæ¨å¯¼ä¸æ€»ç»“"
subtitle: ""
date: 2019-11-20
author: Aether
category: coding
tags: CODE MACHINELEARNING
finished: true
---

## Logisticä»£ä»·å‡½æ•°æ¨å¯¼SVM

0/1æŸå¤±å‡½æ•°$l_{0/1}$éå‡¸ã€éè¿ç»­ï¼Œæ•°å­¦æ€§è´¨å·®ï¼Œæ•…å¸¸ç”¨å…¶ä»–å‡½æ•°ä»£æ›¿$l_{0/1}$

ä¸‰ç§å¸¸ç”¨çš„æ›¿ä»£æŸå¤±å‡½æ•°ï¼š
$$
l_{hinge}(z) = \max(0,1-z)
$$

$$
l_{exp}(z) = e^{-z}
$$

$$
l_{log}(z) = log(1+e^{-z})
$$

### Logistic Regression

$$
\min_\theta \frac{1}{m} \left[ \sum_{i=1}^m y^{(i)}\left[-\log(h_{\theta}(x^{(i)}))\right]+(1-y^{(i)})\left[-\log(1-h_{\theta}(x^{(i)}))\right]\right]+\frac{\lambda}{2m}\sum_{j=1}^n\theta_j^2
$$

$$
\min_\theta  \left[ \sum_{i=1}^m 
y^{(i)}cost_1
+(1-y^{(i)})cost_0\right] 
+\frac{\lambda}{2}\sum_{j=1}^n\theta_j^2 
$$

$$
A + \lambda B
$$

### SVM

$$
C A + B
$$

$$
\min_\theta C  \sum_{i=1}^m\left[ y^{(i)}cost_1(\boldsymbol \theta^T\boldsymbol x^{(i)})+(1-y^{(i)})cost_0({\boldsymbol \theta}^T\boldsymbol x^{(i)})\right]+\frac{1}{2}\sum_{j=1}^n\theta_j^2
$$

å…¶ä¸­SVMä¸­çš„ä»£ä»·å‡½æ•°$cost$é‡‡ç”¨$hinge$æŸå¤±
$$
l_{hinge}(z) = \max(0,1-z)
$$
å¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="../img/svm_cost.png" alt="5" style="zoom:70%;" />

å¯ä»¥ç›´è§‚åœ°å‘ç°å½“$y=1$æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›$\boldsymbol \theta^T\boldsymbol x \gg 1$ï¼Œè¿™æ ·ä½¿$cost_1$æœ€å°ï¼›å½“$y=0$æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›$\boldsymbol \theta^T\boldsymbol x \ll -1$ï¼Œè¿™æ ·ä½¿$cost_0$æœ€å°ã€‚

---

## Margin

è®¾åˆ’åˆ†è¶…å¹³é¢çš„æ–¹ç¨‹ä¸º
$$
\boldsymbol w^T\boldsymbol x +b =0
$$


æ ·æœ¬ä¸­ä»»æ„ç‚¹åˆ°è¯¥è¶…å¹³é¢çš„è·ç¦»ä¸º
$$
d = \frac{\boldsymbol w^T x +b}{||\boldsymbol w||}
$$
å¯¹äº$y=1$ï¼Œ$y=-1$ä¸¤ç±»æ ·æœ¬ç‚¹ï¼Œä»»æ„ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»åº”å¤§äº$d$
$$
\frac{\boldsymbol w^T  x^{(i)} +b}{||\boldsymbol w||} \geq d, \ \forall y^{(i)} = 1\\
\frac{\boldsymbol w^T  x^{(i)} +b}{||\boldsymbol w||} \leq -d, \ \forall y^{(i)} = -1
\\ \Downarrow \\
\frac{\boldsymbol w^T  x^{(i)} +b}{||\boldsymbol w||d} \geq 1, \ \forall y^{(i)} = 1\\
\frac{\boldsymbol w^T  x^{(i)} +b}{||\boldsymbol w||d} \leq -1, \ \forall y^{(i)} = -1
\\ \Downarrow \\
\boldsymbol w_d^T  x^{(i)} +b_d \geq 1, \ \forall y^{(i)} = 1\\
\boldsymbol w_d^T  x^{(i)} +b_d \leq -1, \ \forall y^{(i)} = -1
\\ \Downarrow \\
y^{(i)}(\boldsymbol w^T  x^{(i)} +b) \geq 1
$$
<img src="../img/svm_margin.png" style="zoom:30%;" />

å¯¹äºä»»æ„æ”¯æ’‘å‘é‡ï¼Œä¼˜åŒ–ç›®æ ‡ä¸ºæœ€å¤§åŒ–ç‚¹åˆ°è¶…å¹³é¢çš„è·ç¦»ï¼š


$$
\max \frac{|\boldsymbol w^T x +b|}{||\boldsymbol w||} \Rightarrow \max \frac{1}{||\boldsymbol w||}  \Rightarrow \min \frac{1}{2}||w||^2
$$


åˆ™SVMçš„ä¼˜åŒ–ç›®æ ‡ä¸ºï¼š


$$
\min_{\boldsymbol w,b} \frac{1}{2}||\boldsymbol w||^2 \\
{\rm{s.t.}} \ \ y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)\geq 1, \ i = 1,2,\dots,m.
$$

---

## è½¯é—´éš” Soft Margin SVM

éçº¿æ€§å¯åˆ†æƒ…å†µï¼Œå…è®¸è¯¯å·®$\xi_i$

L1æ­£åˆ™


$$
\min_{\boldsymbol w,b} \frac{1}{2}||\boldsymbol w||^2 + C\sum_{i=1}^m \xi_i\\
{\rm{s.t.}} \ \ y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)\geq 1 - \xi_i \\\ i = 1,2,\dots,m,\ \xi_i\geq0
$$


L2æ­£åˆ™


$$
\min_{\boldsymbol w,b} \frac{1}{2}||\boldsymbol w||^2 + C\sum_{i=1}^m \xi_i^2\\
{\rm{s.t.}} \ \ y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)\geq 1 - \xi_i \\\ i = 1,2,\dots,m,\ \xi_i\geq0
$$

---

## æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§ Lagrangian Duality

â€‹	åœ¨çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜ä¸­ï¼Œå¸¸å¸¸åˆ©ç”¨æ‹‰æ ¼æœ—æ—¥å¯¹å¶æ€§å°†åŸå§‹é—®é¢˜è½¬ä¸ºå¯¹å¶é—®é¢˜ï¼Œé€šè¿‡è§£å†³å¯¹å¶é—®é¢˜è€Œå¾—åˆ°åŸå§‹é—®é¢˜çš„è§£ã€‚å½“æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶ï¼ŒåŸå§‹é—®é¢˜ä¸å¯¹å¶é—®é¢˜çš„è§£æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚ 

åŸå§‹ç›®æ ‡ï¼š


$$
\min_{\boldsymbol w,b} \frac{1}{2}||\boldsymbol w||^2
$$

$$
{\rm{s.t.}} \ \ y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)\geq 1, \ i = 1,2,\dots,m.
$$

ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜æ³•æ„é€ æ‹‰æ ¼æœ—æ—¥å‡½æ•°è½¬åŒ–ä¸ºæ— çº¦æŸä¼˜åŒ–é—®é¢˜ï¼Œå…¶ä¸­æ‹‰æ ¼æœ—æ—¥ä¹˜å­$\alpha_i\geq0$


$$
L(\boldsymbol w,b, \boldsymbol \alpha) = \frac{1}{2}||\boldsymbol w||^2 + \sum_{i=1}^m\alpha_i(1-y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b))
$$


å°†$L(\boldsymbol w,b, \boldsymbol \alpha) $çœ‹ä½œæ˜¯å…³äº$\boldsymbol \alpha$çš„å‡½æ•°ï¼Œæ±‚


$$
\max_{\boldsymbol \alpha} L(\boldsymbol w,b, \boldsymbol \alpha)
$$


å½“æŸä¸ªçº¦æŸæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œå¦‚$$y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)< 1$$ï¼Œé‚£ä¹ˆæ˜¾ç„¶æœ‰$$\max\limits_{\boldsymbol \alpha} L(\boldsymbol w,b, \boldsymbol \alpha) = \infty$$ï¼ˆä»¤$$\alpha_i=\infty$$å³å¯ï¼‰è€Œå½“æ‰€æœ‰çº¦æŸæ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œåˆ™æœ€ä¼˜å€¼ä¸º$$\frac{1}{2}\|\boldsymbol w\|^2$$ï¼Œå³æœ€åˆè¦æœ€å°åŒ–çš„ç›®æ ‡å€¼ã€‚å› æ­¤ï¼Œåœ¨çº¦æŸæ¡ä»¶å¾—åˆ°æ»¡è¶³çš„æƒ…å†µä¸‹æœ€å°åŒ–$$\frac{1}{2}\|\boldsymbol w\|^2$$ï¼Œç­‰åŒäºæ±‚$$\max\limits_{\boldsymbol \alpha} L(\boldsymbol w,b, \boldsymbol \alpha)$$çš„æœ€å°å€¼ã€‚



åŸå§‹ç›®æ ‡å˜ä¸º


$$
\min_{\boldsymbol w,b}\max_{\boldsymbol \alpha} L(\boldsymbol w,b, \boldsymbol \alpha)
$$


è¿™ä¸ªé—®é¢˜åªæœ‰åœ¨æ»¡è¶³çº¦æŸæ¡ä»¶ä¸‹æ‰æœ‰æå°å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªé—®é¢˜çš„æå°å€¼ä¸€å®šæ»¡è¶³çº¦æŸæ¡ä»¶ã€‚

ä»¤$\nabla_\boldsymbol w L = 0$ï¼Œ$\nabla_b L = 0$ï¼Œå¾—ï¼š


$$
\boldsymbol w =\sum_{i=1}^m\alpha_iy_i\boldsymbol x_i
$$

$$
\sum_{i=1}^m\alpha_iy_i = 0
$$

å°†å…¶å¸¦å…¥ï¼Œåˆ™åŸå§‹é—®é¢˜è½¬åŒ–å¯¹å¶é—®é¢˜ï¼š


$$
\max_\boldsymbol \alpha\sum_{i=1}^m \alpha_i-\frac{1}{2}\sum_{i=1}^m\sum_{j=1}^m\alpha_i\alpha_jy_iy_j\boldsymbol x_i\boldsymbol x_j \\
$$

$$
\begin{align}
{\rm{s.t.}} &\  \sum_{i=1}^m\alpha_iy_i = 0,\\ 
&\ \alpha_i\geq0, \ i = 1,2,\dots,m
\end{align}
$$

### å¼ºå¯¹å¶å’Œå¼±å¯¹å¶ strong and weak duality

åŸå§‹é—®é¢˜ Primal Problem


$$
p^* = \min_w \max_{\alpha_i \geq 0} L(\boldsymbol w,b, \boldsymbol \alpha)
$$
å¯¹å¶é—®é¢˜ Dual Problem   


$$
d^* = \max_{\alpha_i \geq 0}\min_w  L(\boldsymbol w,b, \boldsymbol \alpha)
$$
å¼±å¯¹å¶æ€§ï¼š
$$
d^* \leq p^*
$$
å¼ºå¯¹å¶æ€§ï¼š
$$
d^* = p^*
$$

### KKT conditions

- å®šå¸¸æ–¹ç¨‹å¼ stationary equation

$$
\nabla_\boldsymbol w L = 0 
$$

$$
\nabla_b L = 0
$$

- åŸå§‹å¯è¡Œæ€§ primal feasibility 

$$
y^{(i)}(\boldsymbol w^T \boldsymbol x^{(i)}+b)\geq 1
$$

- å¯¹å¶å¯è¡Œæ€§ dual feasibility 

$$
\alpha_i \geq 0
$$

- è¾…æ¾å¼› complementary slackness 

$$
\alpha_i(y^{(i)}f(x^{(i)})-1)=0
$$

---

## æ ¸å‡½æ•° Kernel Trick

åœ¨**çº¿æ€§ä¸å¯åˆ†**çš„æƒ…å†µä¸‹ï¼Œæ”¯æŒå‘é‡æœºé¦–å…ˆåœ¨ä½ç»´ç©ºé—´ä¸­å®Œæˆè®¡ç®—ï¼Œç„¶åé€šè¿‡æ ¸å‡½æ•°å°†è¾“å…¥ç©ºé—´æ˜ å°„åˆ°é«˜ç»´ç‰¹å¾ç©ºé—´ï¼Œæœ€ç»ˆåœ¨é«˜ç»´ç‰¹å¾ç©ºé—´ä¸­æ„é€ å‡ºæœ€ä¼˜åˆ†ç¦»è¶…å¹³é¢ï¼Œä»è€ŒæŠŠå¹³é¢ä¸Šæœ¬èº«ä¸å¥½åˆ†çš„éçº¿æ€§æ•°æ®åˆ†å¼€â€”â€”ä¾é å‡ç»´ä½¿åŸæœ¬çº¿æ€§ä¸å¯åˆ†çš„æ•°æ®çº¿æ€§å¯åˆ†

SVMä¼˜åŒ–é—®é¢˜ç»è¿‡å¯¹å¶è½¬åŒ–ä¸ºäº†


$$
\max_\boldsymbol \alpha\sum_{i=1}^m \alpha_i-\frac{1}{2}\sum_{i=1}^m\sum_{j=1}^m\alpha_i\alpha_jy_iy_j\boldsymbol x_i\boldsymbol x_j
$$

$$
\begin{align}
{\rm{s.t.}} &\  \sum_{i=1}^m\alpha_iy_i = 0,\\ 
&\ \alpha_i\geq0, \ i = 1,2,\dots,m
\end{align}
$$

å¯ä»¥çœ‹åˆ°æ•°æ®ç‚¹ä»…å‡ºç°ä¸ºä¸ºå†…ç§¯$\boldsymbol x_i\boldsymbol x_j$

åªè¦èƒ½åœ¨ç‰¹å¾ç©ºé—´ä¸­è®¡ç®—å‡ºå†…ç§¯ï¼Œå°±ä¸éœ€è¦æ˜¾å¼çš„æ˜ å°„ã€‚è€Œä¸”è®¸å¤šå¸¸è§çš„å‡ ä½•æ“ä½œï¼ˆè§’åº¦ã€è·ç¦»ï¼‰å¯ä»¥ç”¨å†…ç§¯è¡¨ç¤ºã€‚å‡å°‘è®¡ç®—é‡å’Œå‚¨å­˜ç©ºé—´ã€‚

å®šä¹‰æ ¸å‡½æ•°${\rm{K}} (\boldsymbol x_i,\boldsymbol x_j)=\boldsymbol x_i'Â·\boldsymbol x_j'=(\boldsymbol x_iÂ·\boldsymbol x_j+1)^2$

æ ¸å‡½æ•°æœ¬è´¨æ˜¯å°†æ•°æ®æ·»åŠ å¤šé¡¹å¼ç‰¹å¾ $x \rightarrow x'$


$$
x'= (x_n^2,\dots,x_1^2,\sqrt2 x_nx_{n-1},\dots,\sqrt2x_n\dots,\sqrt2 x_1,1)
$$

- æ ¸å‡½æ•°ä¸æ˜¯SVMä¸“æœ‰
- å­˜åœ¨$\boldsymbol x_iÂ·\boldsymbol x_j$å³å¯åº”ç”¨æ ¸å‡½æ•°

#### æ ¸å‡½æ•°ç±»å‹

1. çº¿æ€§æ ¸å‡½æ•° *Linear kernel*

$$
{\rm{K}} (\boldsymbol x_i,\boldsymbol x_j)=\boldsymbol x_iÂ·\boldsymbol x_j
$$

2. å¤šé¡¹å¼æ ¸å‡½æ•° *Polynomial kernel* 

$$
{\rm{K}} (\boldsymbol x_i,\boldsymbol x_j)=(\boldsymbol x_iÂ·\boldsymbol x_j+1)^d
$$

3. é«˜æ–¯æ ¸å‡½æ•° /  å¾„å‘åŸºå‡½æ•° Radial Basis Function Kernel â€”â€” RBF

$$
{\rm{K}} (\boldsymbol x_i,\boldsymbol x_j)=e^{-\gamma||\boldsymbol x_i-\boldsymbol x_j||^2}
$$

å°†æ¯ä¸ªæ ·æœ¬ç‚¹æ˜ å°„åˆ°æ— ç©·ç»´çš„ç‰¹å¾ç©ºé—´ï¼Œæ¯ä¸ªæ•°æ®ç‚¹éƒ½æ˜¯landmark
$$
x \rightarrow (e^{-\gamma||\boldsymbol x-\boldsymbol l_1||^2},e^{-\gamma||\boldsymbol x-\boldsymbol l_2||^2})
$$

$$
m \times n \rightarrow m \times m
$$

åŸæœ¬$n$ç»´çš„æ•°æ®å‡ä¸º$m$ç»´ï¼ˆ$m$ä¸ºæ•°æ®é‡ï¼‰

åº”ç”¨ï¼šè‡ªç„¶è¯­è¨€å¤„ç†

---

## SVMæ€æƒ³è§£å†³å›å½’é—®é¢˜

æ ¸å¿ƒæ€æƒ³ï¼šåœ¨marginé‡ŒåŒ…å«çš„æ ·æœ¬ç‚¹è¶Šå¤šè¶Šå¥½

è¶…å‚æ•°$\epsilon$æŒ‡å®šmarginåˆ°ä¸­é—´ç›´çº¿çš„è·ç¦»